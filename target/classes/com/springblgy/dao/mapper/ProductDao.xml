<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.springblgy.dao.ProductDao">
	<!-- id = IDao.java에 있는 listDao resultType은 Dto 알려줌 -->
	<select id="productDetailDao" resultType="com.springblgy.dto.ProductDetailDto">
		SELECT P.UPLOADERSEQ, U.NICKNAME, P.TITLE, P.PRICE, P.DATE1, P.DATE2, P.INFO, P.IMAGE1, P.HASH, P.INSERTDATE, P.XAXIS, P.YAXIS, P.VIEW, (SELECT check_like(#{param2}, #{param1})) AS LIKED , CASE WHEN P.UPLOADERSEQ = #{param2} THEN 1 ELSE 0 END AS UPLOADERCHECK
		FROM PRODUCT P, USERDATA U
		WHERE P.UPLOADERSEQ = U.USERSEQ AND P.PRDSEQ = #{param1}
	</select>
	
	<select id="productCMTDao" resultType="com.springblgy.dto.ProductCommentDto">
		SELECT C.CMTSEQ, C.USERSEQ, U.NICKNAME, C.COMMENT, C.INSERTDATE, CASE WHEN C.USERSEQ = #{param2} THEN 1 ELSE 0 END AS USERCHECK FROM USERDATA U, COMMENT C WHERE C.USERSEQ = U.USERSEQ AND C.READFT = 1 AND PRDSEQ = #{param1};
	</select>
	
	<update id="updateViewDao">
		UPDATE PRODUCT SET VIEW = VIEW + 1 WHERE PRDSEQ = #{param1}
	</update>

</mapper>